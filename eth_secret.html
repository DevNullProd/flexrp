<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="eth_secret.css" />
    <script type="text/javascript" src="./dialog.js"></script>
    <script type="text/javascript">
      const {ipcRenderer} = require('electron')

      document.addEventListener("DOMContentLoaded", function(){
        show_dialog({
          buttons : [{
            text : "CANCEL",
            id : "cancel"
          },{
            text : "OK",
            id : "ok",
            disabled : true
          }]
        });

        var eth_account;
        const eth_secret = document.getElementById("eth_secret")
        ipcRenderer.on("got_eth_account", (event, account) => {
          eth_account = account;

          var text = document.createTextNode(account.secret);
          eth_secret.appendChild(text)
        })
        ipcRenderer.send("get_eth_account")

        const ok = document.getElementById("ok")
        ok.addEventListener("click", function(){
          ipcRenderer.send("persist_eth_account")
          ipcRenderer.send("close_window")
        })

        const saved = document.getElementById("saved")
        saved.addEventListener("change", function() {
          ok.disabled = !this.checked;
        }, false);

        const cancel = document.getElementById("cancel");
        cancel.addEventListener("click", function() {
          ipcRenderer.send("close_window")
        }, false)

        const copy = document.getElementById("copy");
        copy.addEventListener("click", function(){
          navigator.clipboard.writeText(eth_account.secret)
                   .then(function(){
                     alert("Copied!")
                   }).catch(function(){
                     alert("Problem Copying Key")
                   })
        })
      });
    </script>
</head>

<body>
  <h2>This is your ETH Secret:</h2>

  <div id="eth_secret_container">
    <div id="eth_secret"></div>
    <img id="copy" title="Copy" src="assets/copy.svg" />
  </div>

  <label for="saved">I have saved this</label>
  <input type="checkbox" id="saved" />
</body>
</html>
