<!-- Renders ethereum secret with save confirmation -->
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../css/eth_secret.css" />
    <script type="text/javascript" src="../js/dialog.js"></script>
    <script type="text/javascript">
      const {ipcRenderer} = require('electron')

      document.addEventListener("DOMContentLoaded", function(){
        show_dialog({
          buttons : [{
            text : "CANCEL",
            id : "cancel"
          },{
            text : "OK",
            id : "ok",
            disabled : true
          }]
        });

        // Load generated secret and append to page
        var eth_account;
        const eth_secret = document.getElementById("eth_secret")
        ipcRenderer.on("got_eth_account", (event, account) => {
          eth_account = account;

          var text = document.createTextNode(account.secret);
          eth_secret.appendChild(text)
        })
        ipcRenderer.send("get_eth_account")

        // Persist account and close window on OK
        const ok = document.getElementById("ok")
        ok.addEventListener("click", function(){
          ipcRenderer.send("persist_eth_account")
          ipcRenderer.send("close_window")
        })

        // Only allow 'ok' if user confirmed save
        const saved = document.getElementById("saved")
        saved.addEventListener("change", function() {
          ok.disabled = !this.checked;
        }, false);

        // Just close window on cancel
        const cancel = document.getElementById("cancel");
        cancel.addEventListener("click", function() {
          ipcRenderer.send("close_window")
        }, false)

        // Copy secret to clipboard on command
        const copy = document.getElementById("copy");
        copy.addEventListener("click", function(){
          navigator.clipboard.writeText(eth_account.secret)
                   .then(function(){
                     alert("Copied!")
                   }).catch(function(){
                     alert("Problem Copying Key")
                   })
        })
      });
    </script>
</head>

<body>
  <h2>This is your ETH Secret:</h2>

  <div id="eth_secret_container">
    <div id="eth_secret"></div>
    <img id="copy" title="Copy" src="../assets/copy.svg" />
  </div>

  <h3>Once this window is closed IT WILL BE GONE FOREVER</h3>

  <label for="saved">I have saved this</label>
  <input type="checkbox" id="saved" />
</body>
</html>
